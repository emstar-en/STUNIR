# Generated by STUNIR (python backend, minimal)
from __future__ import annotations
import json
from pathlib import Path

def _find_receipts_dir() -> Path:
    p = Path(__file__).resolve()
    # .../asm/python/<variant>/program.py
    asm_dir = p.parents[2]  # .../asm
    out_dir = asm_dir.parent  # repo root or .../samples/out/<sample>
    return out_dir / 'receipts'

def main() -> int:
    receipts = _find_receipts_dir()
    ir_manifest = receipts / 'ir_manifest.json'
    if not ir_manifest.exists():
        raise SystemExit(f'ir_manifest not found: {ir_manifest}')
    obj = json.loads(ir_manifest.read_text(encoding='utf-8'))
    files = []
    if isinstance(obj, dict) and isinstance(obj.get('files'), list):
        for it in obj['files']:
            if isinstance(it, dict) and 'file' in it:
                files.append(str(it['file']))
    epoch = None
    if isinstance(obj, dict):
        epoch = (obj.get('epoch') or {}).get('selected_epoch')
    out = {'backend': 'python', 'epoch': epoch, 'ir_files': files}
    print(json.dumps(out, sort_keys=True, separators=(',',':'), ensure_ascii=False))
    return 0

if __name__ == '__main__':
    raise SystemExit(main())
