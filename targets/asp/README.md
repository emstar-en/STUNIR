# ASP Emitters (Answer Set Programming)

Part of Phase 7D: Answer Set Programming

## Overview

The ASP emitters convert ASP IR programs to specific ASP solver formats:
- **Clingo Emitter**: Generates ASP-Core-2 compatible code for Clingo/Gringo
- **DLV Emitter**: Generates code for the DLV system with disjunctive support

## Features

### Clingo Emitter

- Full ASP-Core-2 standard support
- Choice rules with bounds
- Aggregates (#count, #sum, #min, #max)
- Weak constraints with weights and priorities
- Optimization statements (#minimize, #maximize)
- Show statements for output control
- Configurable output formatting

### DLV Emitter

- Native disjunctive rule support
- Classic and DLV2-compatible syntax
- Weak constraint conversion (`:` vs `@` syntax)
- Choice rule approximation (converted to disjunctive)
- Full aggregate support

## Module Structure

```
targets/asp/
├── __init__.py          # Package exports
├── clingo_emitter.py    # Clingo format emitter
├── dlv_emitter.py       # DLV format emitter
└── README.md            # This file
```

## Usage

### Basic Emission

```python
from ir.asp import ASPProgram, atom, var, pos, neg, ChoiceElement
from targets.asp import emit_clingo, emit_dlv

# Create a program
p = ASPProgram("example")
p.add_fact(atom("node", "a"))
p.add_fact(atom("node", "b"))
p.add_fact(atom("edge", "a", "b"))

p.add_normal_rule(
    atom("path", var("X"), var("Y")),
    [pos(atom("edge", var("X"), var("Y")))]
)

# Emit to Clingo
clingo_result = emit_clingo(p)
print(clingo_result.code)

# Emit to DLV
dlv_result = emit_dlv(p)
print(dlv_result.code)
```

### Configuring Output

```python
from targets.asp import ClingoEmitter, ClingoConfig, DLVConfig

# Clingo configuration
config = ClingoConfig(
    include_comments=True,
    pretty_print=True,
    include_header=True,
    include_metadata=True
)
emitter = ClingoEmitter(config)
result = emitter.emit(program)

# DLV configuration
dlv_config = DLVConfig(
    use_v_disjunction=True,   # Use 'v' instead of '|'
    dlv2_compatible=False      # Use classic DLV syntax
)
```

### Writing to Files

```python
from targets.asp import emit_clingo_to_file, emit_dlv_to_file

emit_clingo_to_file(p, "program.lp")
emit_dlv_to_file(p, "program.dlv")
```

## Output Formats

### Clingo Output Example

```asp
% ASP Program: graph_coloring
% Generated by STUNIR Clingo Emitter v1.0.0
% Dialect: clingo

% Facts
node(1).
node(2).
edge(1, 2).
col(red).
col(green).

% Choice Rules
1 { color(X, C) : col(C) } 1 :- node(X).

% Constraints
:- edge(X, Y), color(X, C), color(Y, C).

% Output
#show color/2.
```

### DLV Output Example

```asp
% ASP Program: brave_cautious
% Generated by STUNIR DLV Emitter v1.0.0
% Dialect: dlv

% Facts
node(1).
node(2).
edge(1, 2).

% Disjunctive Rules
p(X) v q(X) :- r(X).

% Weak Constraints
:~ violated(X). [1:0, X]
```

## Syntax Differences

| Feature | Clingo | DLV |
|---------|--------|-----|
| Disjunction | `h1 \| h2` | `h1 v h2` |
| Weak constraint | `[w@p]` | `[w:p]` (classic) |
| Choice rules | Native | Converted |
| Aggregates | Same syntax | Same syntax |
| Default negation | `not` | `not` |
| Classical negation | `-` | `-` |

## Manifest Generation

Each emitter generates a manifest with metadata:

```python
result = emit_clingo(program)
print(result.manifest)
# {
#   "schema": "stunir.asp.clingo.v1",
#   "program_name": "graph_coloring",
#   "dialect": "clingo",
#   "rules_count": 15,
#   "facts_count": 9,
#   "constraints_count": 1,
#   "predicates": ["color", "col", "edge", "node"],
#   "code_hash": "abc123...",
#   "code_size": 512
# }
```

## Running Generated Code

### Clingo

```bash
# Install Clingo
pip install clingo
# or
apt-get install gringo clasp

# Run program
clingo program.lp 0  # Find all stable models
```

### DLV

```bash
# Download DLV from https://www.dlvsystem.com/

# Run program
dlv program.dlv -brave  # Brave reasoning
dlv program.dlv -cautious  # Cautious reasoning
```

## Common ASP Problems

### Graph Coloring

Find valid colorings where adjacent nodes have different colors.

### Hamiltonian Path

Find a path visiting each node exactly once.

### Knapsack

Optimize item selection given weight and value constraints.

### Scheduling

Assign tasks to workers respecting constraints.

### N-Queens

Place N queens on an NxN board with no conflicts.

## See Also

- [ir/asp/README.md](../../ir/asp/README.md) - ASP IR documentation
- [Clingo Guide](https://potassco.org/doc/start/) - Official Clingo documentation
- [DLV Manual](https://www.dlvsystem.com/dlvUserManual.pdf) - DLV user manual
- [ASP-Core-2 Standard](https://www.mat.unical.it/aspcomp2013/ASPStandardization)
