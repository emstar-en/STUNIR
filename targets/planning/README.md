# Planning Emitters

PDDL emitter for STUNIR - generating automated planning domain and problem files.

## Overview

The planning emitters module generates PDDL (Planning Domain Definition Language) files that can be used with automated planners like:
- FF Planner
- FastDownward
- LAMA
- LPG
- SGPlan
- And many others

## Module Structure

```
targets/planning/
├── __init__.py          # Package exports
├── pddl_emitter.py      # PDDL format emitter
└── README.md            # This file
```

## PDDL Emitter

### Basic Usage

```python
from ir.planning import Domain, Problem, Action, Predicate, Parameter, Formula, Effect
from targets.planning import PDDLEmitter

# Create domain and problem (see ir/planning/README.md)
# ...

# Create emitter
emitter = PDDLEmitter()

# Emit domain
result = emitter.emit_domain(domain)
print(result.domain_code)

# Emit problem
result = emitter.emit_problem(problem)
print(result.problem_code)

# Emit both
result = emitter.emit(domain, problem)
result.write_domain("domain.pddl")
result.write_problem("problem.pddl")
```

### Output Format

#### Domain File
```lisp
;; PDDL Domain: blocks-world
;; Generated by STUNIR PDDL Emitter v2.1

(define (domain blocks-world)
  (:requirements :strips :typing)
  
  (:types
    block
  )
  
  (:predicates
    (on ?x - block ?y - block)
    (ontable ?x - block)
    (clear ?x - block)
    (holding ?x - block)
    (arm-empty)
  )
  
  (:action pick-up
    :parameters (?x - block)
    :precondition
      (and
        (clear ?x)
        (ontable ?x)
        (arm-empty)
      )
    :effect
      (and
        (holding ?x)
        (not (ontable ?x))
        (not (clear ?x))
        (not (arm-empty))
      )
  )
)
```

#### Problem File
```lisp
;; PDDL Problem: blocks-4-0
;; Domain: blocks-world
;; Generated by STUNIR PDDL Emitter v2.1

(define (problem blocks-4-0)
  (:domain blocks-world)
  
  (:objects
    b1 b2 b3 b4 - block
  )
  
  (:init
    (clear b1)
    (on b1 b2)
    (on b2 b3)
    (ontable b3)
    (ontable b4)
    (clear b4)
    (arm-empty)
  )
  
  (:goal (and
    (on b4 b3)
    (on b3 b2)
    (on b2 b1)
  ))
)
```

## Supported PDDL Features

### Requirements

| Requirement | Description | Example |
|-------------|-------------|----------|
| `:strips` | Basic STRIPS | Default planning |
| `:typing` | Typed objects | `?x - block` |
| `:negative-preconditions` | Negated preconditions | `(not (holding ?x))` |
| `:disjunctive-preconditions` | OR in preconditions | `(or ...)` |
| `:equality` | Equality predicate | `(= ?x ?y)` |
| `:existential-preconditions` | Exists quantifier | `(exists (?x) ...)` |
| `:universal-preconditions` | Forall quantifier | `(forall (?x) ...)` |
| `:conditional-effects` | When effects | `(when cond eff)` |
| `:numeric-fluents` | Numeric functions | `(increase (cost) 1)` |
| `:action-costs` | Action costs | `(:metric minimize (total-cost))` |

### Formula Types

- `ATOM` - Predicate application
- `AND` - Conjunction
- `OR` - Disjunction
- `NOT` - Negation
- `IMPLY` - Implication
- `EXISTS` - Existential quantification
- `FORALL` - Universal quantification
- `WHEN` - Conditional effect
- `EQUALS` - Equality

### Effect Types

- `POSITIVE` - Add fact
- `NEGATIVE` - Delete fact
- `COMPOUND` - Multiple effects (and)
- `CONDITIONAL` - When effect
- `FORALL` - Universal effect
- `INCREASE` - Numeric increase
- `DECREASE` - Numeric decrease
- `ASSIGN` - Numeric assignment

## Manifest Generation

The emitter generates deterministic manifests for build tracking:

```python
result = emitter.emit_domain(domain)
print(result.manifest)
# {
#   'schema': 'stunir.manifest.planning.v1',
#   'generator': 'stunir.pddl.emitter.v2.1',
#   'epoch': 1706500000,
#   'domain': {
#     'name': 'blocks-world',
#     'actions': 4,
#     'predicates': 5,
#     'types': 1,
#     ...
#   },
#   'output': {
#     'hash': 'sha256...',
#     'size': 1234,
#     'format': 'pddl'
#   },
#   'manifest_hash': 'sha256...'
# }
```

## Example Domains

### Blocks World
Classic planning benchmark for block stacking.

### Logistics
Transportation planning with trucks and packages.

### Gripper
Robot manipulation with a gripper arm.

### Depot
Combination of logistics and blocks world.

See `tests/codegen/test_planning_emitters.py` for complete examples.

## Integration with Planners

```bash
# Generate PDDL files
python generate_pddl.py

# Run with FastDownward
fast-downward domain.pddl problem.pddl --search "astar(lmcut())"

# Run with FF
ff -o domain.pddl -f problem.pddl
```
