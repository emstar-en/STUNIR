{"schema":"stunir_flat_ir_v1","ir_version":"v1","module_name":"ap_math_crc","docstring":"TEST OUTPUT: STUNIR analysis of ArduPilot AP_Math CRC module - DO-178C compliant specification","types":[],"functions":[{"name":"crc_crc4","args":[{"name":"data","type":"u16[]"}],"return_type":"u16","steps":[{"op":"assign","target":"n_rem","value":"0"},{"op":"assign","target":"cnt","value":"0"},{"op":"while","condition":"cnt < 16","block_start": 4,"block_count": 12},{"op":"if","condition":"cnt & 1","block_start": 5,"block_count": 2,"else_start": 7,"else_count": 1},{"op":"assign","target":"n_rem","value":"n_rem ^ (data[cnt >> 1] & 0x00FF)"},{"op":"assign","target":"n_rem","value":"n_rem ^ (data[cnt >> 1] >> 8)"},{"op":"assign","target":"n_rem","value":"n_rem ^ (data[cnt >> 1] >> 8)"},{"op":"assign","target":"n_bit","value":"8"},{"op":"while","condition":"n_bit > 0","block_start": 10,"block_count": 5},{"op":"if","condition":"n_rem & 0x8000","block_start": 11,"block_count": 2,"else_start": 13,"else_count": 1},{"op":"assign","target":"n_rem","value":"(n_rem << 1) ^ 0x3000"},{"op":"assign","target":"n_rem","value":"n_rem << 1"},{"op":"assign","target":"n_rem","value":"n_rem << 1"},{"op":"assign","target":"n_bit","value":"n_bit - 1"},{"op":"assign","target":"cnt","value":"cnt + 1"},{"op":"return","value":"(n_rem >> 12) & 0xF"}]},{"name":"crc_crc8","args":[{"name":"p","type":"u8[]"},{"name":"len","type":"u8"}],"return_type":"u8","steps":[{"op":"assign","target":"crc","value":"0x0"},{"op":"while","condition":"len > 0","block_start": 3,"block_count": 4},{"op":"assign","target":"i","value":"(crc ^ *p) & 0xFF"},{"op":"assign","target":"crc","value":"(crc8_table[i] ^ (crc << 8)) & 0xFF"},{"op":"assign","target":"p","value":"p + 1"},{"op":"assign","target":"len","value":"len - 1"},{"op":"return","value":"crc & 0xFF"}]},{"name":"crc8_dvb_s2","args":[{"name":"crc","type":"u8"},{"name":"a","type":"u8"}],"return_type":"u8","steps":[{"op":"return","value":"crc8_dvb(crc, a, 0xD5)"}]},{"name":"crc8_dvb","args":[{"name":"crc","type":"u8"},{"name":"a","type":"u8"},{"name":"seed","type":"u8"}],"return_type":"u8","steps":[{"op":"assign","target":"i","value":"0"},{"op":"assign","target":"crc","value":"crc ^ a"},{"op":"while","condition":"i < 8","block_start": 4,"block_count": 5},{"op":"if","condition":"crc & 0x80","block_start": 5,"block_count": 2,"else_start": 7,"else_count": 1},{"op":"assign","target":"crc","value":"(crc << 1) ^ seed"},{"op":"assign","target":"crc","value":"crc << 1"},{"op":"assign","target":"crc","value":"crc << 1"},{"op":"assign","target":"i","value":"i + 1"},{"op":"return","value":"crc"}]},{"name":"crc16_ccitt","args":[{"name":"buf","type":"u8[]"},{"name":"len","type":"u32"},{"name":"crc","type":"u16"}],"return_type":"u16","steps":[{"op":"assign","target":"i","value":"0"},{"op":"while","condition":"i < len","block_start": 3,"block_count": 3},{"op":"assign","target":"crc","value":"(crc << 8) ^ crc16tab[((crc >> 8) ^ *buf) & 0x00FF]"},{"op":"assign","target":"buf","value":"buf + 1"},{"op":"assign","target":"i","value":"i + 1"},{"op":"return","value":"crc"}]},{"name":"crc_fletcher16","args":[{"name":"buffer","type":"u8[]"},{"name":"len","type":"u32"}],"return_type":"u16","steps":[{"op":"assign","target":"c0","value":"0"},{"op":"assign","target":"c1","value":"0"},{"op":"assign","target":"i","value":"0"},{"op":"while","condition":"i < len","block_start": 5,"block_count": 3},{"op":"assign","target":"c0","value":"(c0 + buffer[i]) % 255"},{"op":"assign","target":"c1","value":"(c1 + c0) % 255"},{"op":"assign","target":"i","value":"i + 1"},{"op":"return","value":"(c1 << 8) | c0"}]},{"name":"crc8_table","args":[],"return_type":"void","steps":[]},{"name":"crc16tab","args":[],"return_type":"void","steps":[]},{"name":"vector2_length_squared","args":[{"name":"x","type":"f32"},{"name":"y","type":"f32"}],"return_type":"f32","steps":[{"op":"return","value":"x*x + y*y"}]},{"name":"vector2_length","args":[{"name":"x","type":"f32"},{"name":"y","type":"f32"}],"return_type":"f32","steps":[{"op":"return","value":"sqrt(x*x + y*y)"}]},{"name":"vector2_limit_length","args":[{"name":"x","type":"f32"},{"name":"y","type":"f32"},{"name":"max_length","type":"f32"}],"return_type":"bool","steps":[{"op":"assign","target":"len","value":"vector2_length(x, y)"},{"op":"if","condition":"len > max_length && len > 0","block_start": 3,"block_count": 3},{"op":"assign","target":"x","value":"x * (max_length / len)"},{"op":"assign","target":"y","value":"y * (max_length / len)"},{"op":"return","value":"true"},{"op":"return","value":"false"}]},{"name":"vector2_dot_product","args":[{"name":"x1","type":"f32"},{"name":"y1","type":"f32"},{"name":"x2","type":"f32"},{"name":"y2","type":"f32"}],"return_type":"f32","steps":[{"op":"return","value":"x1*x2 + y1*y2"}]},{"name":"vector2_cross_product","args":[{"name":"x1","type":"f32"},{"name":"y1","type":"f32"},{"name":"x2","type":"f32"},{"name":"y2","type":"f32"}],"return_type":"f32","steps":[{"op":"return","value":"x1*y2 - y1*x2"}]},{"name":"vector2_angle_between","args":[{"name":"x1","type":"f32"},{"name":"y1","type":"f32"},{"name":"x2","type":"f32"},{"name":"y2","type":"f32"}],"return_type":"f32","steps":[{"op":"assign","target":"len","value":"vector2_length(x1, y1) * vector2_length(x2, y2)"},{"op":"if","condition":"len <= 0","block_start": 3,"block_count": 1},{"op":"return","value":"0.0"},{"op":"assign","target":"cosv","value":"vector2_dot_product(x1, y1, x2, y2) / len"},{"op":"if","condition":"cosv >= 1.0","block_start": 6,"block_count": 1},{"op":"return","value":"0.0"},{"op":"if","condition":"cosv <= -1.0","block_start": 8,"block_count": 1},{"op":"return","value":"3.14159265"},{"op":"return","value":"acos(cosv)"}]},{"name":"vector2_normalize","args":[{"name":"x","type":"f32"},{"name":"y","type":"f32"}],"return_type":"void","steps":[{"op":"assign","target":"len","value":"vector2_length(x, y)"},{"op":"if","condition":"len > 0","block_start": 3,"block_count": 2},{"op":"assign","target":"x","value":"x / len"},{"op":"assign","target":"y","value":"y / len"}]},{"name":"vector2_segment_intersection","args":[{"name":"seg1_start_x","type":"f32"},{"name":"seg1_start_y","type":"f32"},{"name":"seg1_end_x","type":"f32"},{"name":"seg1_end_y","type":"f32"},{"name":"seg2_start_x","type":"f32"},{"name":"seg2_start_y","type":"f32"},{"name":"seg2_end_x","type":"f32"},{"name":"seg2_end_y","type":"f32"}],"return_type":"bool","steps":[{"op":"assign","target":"r1_x","value":"seg1_end_x - seg1_start_x"},{"op":"assign","target":"r1_y","value":"seg1_end_y - seg1_start_y"},{"op":"assign","target":"r2_x","value":"seg2_end_x - seg2_start_x"},{"op":"assign","target":"r2_y","value":"seg2_end_y - seg2_start_y"},{"op":"assign","target":"r1xr2","value":"r1_x * r2_y - r1_y * r2_x"},{"op":"if","condition":"r1xr2 == 0","block_start": 7,"block_count": 1},{"op":"return","value":"false"},{"op":"assign","target":"ss2_ss1_x","value":"seg2_start_x - seg1_start_x"},{"op":"assign","target":"ss2_ss1_y","value":"seg2_start_y - seg1_start_y"},{"op":"assign","target":"t","value":"(ss2_ss1_x * r2_y - ss2_ss1_y * r2_x) / r1xr2"},{"op":"assign","target":"u","value":"(ss2_ss1_x * r1_y - ss2_ss1_y * r1_x) / r1xr2"},{"op":"if","condition":"u >= 0 && u <= 1 && t >= 0 && t <= 1","block_start": 13,"block_count": 3},{"op":"assign","target":"out_x","value":"seg1_start_x + r1_x * t"},{"op":"assign","target":"out_y","value":"seg1_start_y + r1_y * t"},{"op":"return","value":"true"},{"op":"return","value":"false"}]}]}
