{"schema":"stunir.machine_spec.v1","id":"stunir.ir_bundle.v1","title":"STUNIR IR bundle v1 (byte_exact for IR bundle bytes; layout-independent)","scope":{"byte_exact_applies_to":["ir_bundle_bytes"],"explicitly_not_byte_exact":["receipts","emitted_outputs","logs","package_zip"]},"modes":{"default":"semantic","semantic":{"guarantee":"semantic_equivalence","anchor":"cir_sha256","notes":"Emitters may vary by platform/toolchain; receipts must bind outputs to CIR."},"byte_exact":{"guarantee":"ir_bundle_bytes_are_a_pure_function_of_canonical_ir_content","definition":{"bundle_value":{"type":"cbor_array","len":2,"items":[{"type":"text","const":"stunir.ir_bundle.v1"},{"type":"canonical_ir_object_model"}]},"bundle_bytes":"dcbor_canonical_encode(bundle_value)"},"engine_priority":["native_bin","python_fallback"],"missing_engine_policy":"hard_fail"}},"canonical_ir_content":{"type":"canonical_ir_object_model","layout_independent":true,"forbid_environment_dependent_fields":true,"string_normalization":{"unicode":"NFC","encoding":"utf-8"},"float_policy":{"byte_exact":"forbid_floats","rationale":"Avoid cross-encoder divergence from alternative float encodings."}},"encoding":{"family":"dcbor","canonical":true,"definite_lengths_only":true,"indefinite_lengths":"forbidden","map_key_order":"canonical","integer_encoding":"shortest","byte_string_encoding":"canonical","text_string_encoding":"utf-8"},"hashes":{"cir_sha256":"sha256(dcbor_canonical_encode(canonical_ir_object_model))","ir_bundle_sha256":"sha256(ir_bundle_bytes)"},"receipts":{"required_fields":["ir_bundle.mode","ir_bundle.id","ir_bundle.format_version","ir_bundle.sha256","ir_bundle.cir_sha256","ir_bundle.engine.type","ir_bundle.engine.version_or_build","ir_bundle.encoding.family","ir_bundle.float_policy","ir_bundle.unicode_normalization"],"explain_differences":{"primary_anchor":"cir_sha256","rule":"If cir_sha256 matches, semantic outputs may differ; receipts must record emitter identity/config."}},"conformance_tests":{"cross_matrix":{"precondition":"Two implementations produce identical canonical IR content (same cir_sha256).","assertions":["In byte_exact mode, ir_bundle_sha256 must match across implementations/platforms.","In semantic mode, emitted outputs may differ; receipts must bind them to the same cir_sha256."]}},"versioning":{"format_version":1,"backwards_compat_policy":"Newer readers may support older formats; older readers may reject newer.","evolution":"Bump id/version only when canonical encoding rules or CIR model changes in a way that affects bytes."}}