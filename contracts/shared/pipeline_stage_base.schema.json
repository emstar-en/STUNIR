{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "stunir.contracts.shared.pipeline_stage_base.v1.schema.json",
  "title": "STUNIR Pipeline Stage Base Schema",
  "description": "Base schema for all STUNIR pipeline stage contracts",
  "type": "object",
  "required": ["stage_id", "schema_version", "stage_type"],
  "properties": {
    "stage_id": {
      "type": "string",
      "description": "Unique identifier for this pipeline stage"
    },
    "schema_version": {
      "type": "string",
      "pattern": "^v[0-9]+$",
      "description": "Version of this schema"
    },
    "stage_type": {
      "type": "string",
      "enum": ["validation", "verification", "attestation", "runtime"],
      "description": "Type of pipeline stage"
    },
    "dependencies": {
      "type": "array",
      "items": {"type": "string"},
      "description": "List of stage IDs this stage depends on"
    },
    "input_receipt_schema": {
      "type": "string",
      "description": "Reference to input receipt schema"
    },
    "output_receipt_schema": {
      "type": "string",
      "description": "Reference to output receipt schema"
    },
    "verifier": {
      "type": "object",
      "properties": {
        "type": {"type": "string", "enum": ["script", "binary", "module"]},
        "path": {"type": "string"},
        "mode": {"type": "string", "enum": ["strict", "minimal", "permissive"]}
      }
    },
    "success_criteria": {
      "type": "object",
      "additionalProperties": {"type": "boolean"}
    }
  }
}
