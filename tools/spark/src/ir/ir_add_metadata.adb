"with Ada.Command_Line; with Ada.Text_IO; with Ada.Strings.Unbounded;\nwith Ada.Calendar; with Ada.Calendar.Formatting;\n\npackage body IR_Add_Metadata is\n\n   function Get_Current_Timestamp return String is\n      Time : constant Ada.Calendar.Time := Ada.Calendar.Clock;\n      Image : String (1..20);\n   begin\n      Ada.Calendar.Formatting.Split(Time, Image(1..4), Image(5..7),\n                                    Image(8..9), Image(10..11),\n                                    Image(12..13), Image(14..15),\n                                    Image(16..17), Image(18..19);\n      return Image;\n   end Get_Current_Timestamp;\n\n   procedure Process_IR is\n      Partial_IR : constant String := Get_Input_From_Stdin;\n      IR_Output  : Unbounded_String;\n      Schema     : constant String := Get_Flag_Value(\"--schema\", \"stunir_flat_ir_v1\");\n      Version    : constant String := Get_Flag_Value(\"--version\", \"0.1.0\");\n   begin\n      -- Start building the complete IR JSON output\n      IR_Output := To_Unbounded_String(\"{\") & \n                  To_Unbounded_String(\"\\\"schema\\\": \\\"\") & \n                  To_Unbounded_String(Schema) & \n                  To_Unbounded_String(\"\\\",\\n  \\\"ir_version\\\": \\\"\") & \n                  To_Unbounded_String(Version) & \n                  To_Unbounded_String(\"\\\",\\n  \\\"generated_at\\\": \\\"\") & \n                  To_Unbounded_String(Get_Current_Timestamp) & \n                  To_Unbounded_String(\"\\\"}\"));\n\n      -- Merge with existing IR content\n      if Partial_IR'Length > 0 then\n         IR_Output := Append(IR_Output, To_Unbounded_String(\",\") & \n                                   To_Unbounded_String(Partial_IR));\n      end if;\n\n      -- Complete the JSON structure\n      IR_Output := Append(IR_Output, To_Unbounded_String(\"}"));\n\n      Ada.Text_IO.Put_Line(To_String(IR_Output));\n   exception\n      when others =>\n         Ada.Text_IO.Put_Line(\"ERROR: \" & Ada.Exceptions.Exception_Information);\n         Set_Exit_Failure;\n   end Process_IR;\n\nend IR_Add_Metadata;"