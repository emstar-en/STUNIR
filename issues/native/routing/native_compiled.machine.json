{
  "category": [
    "native",
    "routing"
  ],
  "evidence": [
    {
      "lines": {
        "end": 20,
        "start": 1
      },
      "note": "Forces shell receipt generation and logs via undefined log_info.",
      "path": "scripts/lib/dispatch.sh",
      "sha256": "64e24097e15bb34d81ce002bd80f9e0531d103fb74b0ee0467565215ff2422ca",
      "snippet_sha256": "6d8f3e926ee155238790fe71945a3917be89df0bbe4b773b95f858a42dd7b9b4"
    },
    {
      "lines": {
        "end": 12,
        "start": 1
      },
      "note": "Stages native binary to build/stunir_native but nothing invokes it.",
      "path": "scripts/build.sh",
      "sha256": "62e9cfb279b0c0f1519117f570d27e8c40146fb0cef802398765160523f17b58",
      "snippet_sha256": "4fd440d90fd657834282ddde88268a90cf9b8d5700e7d96ed5408f5e95006fc8"
    },
    {
      "lines": {
        "end": 60,
        "start": 20
      },
      "note": "Uses Python tools + record_receipt.py pipeline.",
      "path": "scripts/build_docker.sh",
      "sha256": "8af694aadf57adb39a0a53e508a107af7da5f4b55dd4a1e381537f9fe76ee3fc",
      "snippet_sha256": "59b598241e4de013803dc6242ed17c0990d15b041cc6f193f9c2d26092d1d427"
    }
  ],
  "expected": [
    "Compiled/native tools should be the default path where available, with Python as a fallback, while maintaining identical receipts/canonicalization."
  ],
  "id": "ISSUE.NATIVE.0001",
  "impact": {
    "breaks_build": false,
    "breaks_local_verify_strict": false,
    "breaks_receipt_generation": false
  },
  "proposed_fixes": [
    {
      "description": "Implement routing precedence: compiled/native first (if present + version/sha pinned), then Python, then shell. Require identical canonical JSON + receipt_core_id hashing.",
      "touched_paths": [
        "scripts/lib/dispatch.sh",
        "scripts/build.sh",
        "tools/native/rust/stunir-native/src/main.rs"
      ]
    }
  ],
  "related": [
    "ISSUE.DISPATCH.0001",
    "ISSUE.RECEIPT.0001",
    "ISSUE.BUILD.0001"
  ],
  "reproduction": [
    "ls -l tools/native/rust/stunir-native || true",
    "./scripts/build.sh"
  ],
  "root_causes": [
    {
      "details": "scripts/lib/dispatch.sh hard-codes STUNIR_USE_NATIVE_RECEIPT=0 and does not implement any routing logic.",
      "type": "routing_policy"
    }
  ],
  "schema": "stunir.issues.issue.v1",
  "severity": "medium",
  "status": "CLOSED",
  "symptoms": [
    "scripts/build.sh stages build/stunir_native if present, but the dispatcher does not route to it.",
    "scripts/build_docker.sh uses Python tools end-to-end (except gcc container compile)."
  ],
  "title": "Native/compiled route is not the primary execution path (dispatch forces shell receipt; build_docker uses Python tools)",
  "workarounds": [
    {
      "commands": [
        "./scripts/build_docker.sh",
        "./scripts/verify.sh --local --strict"
      ],
      "description": "Treat the Python pipeline as authoritative for verifier compatibility until dispatch is restored."
    }
  ],
  "resolution": "Implemented in Native Core / Shell Integration Pack"
}