{"category":["native","haskell"],"evidence":[{"lines":{"end":40,"start":1},"note":"Shows Rust-native staging into build/stunir_native and subsequent dependence on a dispatcher; no Haskell-native route is present.","path":"scripts/build.sh","sha256":"62e9cfb279b0c0f1519117f570d27e8c40146fb0cef802398765160523f17b58","snippet_sha256":"57f8647ec8be008a9b0cbd24a746fe764aa838c1a650aeee317e47a71067c495"},{"lines":{"end":12,"start":1},"note":"Dispatch library stub forces shell receipts and references log_info without defining stunir_dispatch; not compatible with Haskell-first routing.","path":"scripts/lib/dispatch.sh","sha256":"64e24097e15bb34d81ce002bd80f9e0531d103fb74b0ee0467565215ff2422ca","snippet_sha256":"6d8f3e926ee155238790fe71945a3917be89df0bbe4b773b95f858a42dd7b9b4"}],"expected":["A deterministic, documented Haskell-first routing contract: when a pinned Haskell-native binary is available, it is selected as the primary implementation for canonical bytes/hashes.","A functional dispatcher interface (stunir_dispatch + helpers) that can route key build/verify primitives to the Haskell-native binary.","Other backends (Rust/Python) are explicitly positioned as conformance-tested implementations against Haskell outputs."],"id":"ISSUE.HASKELL.0001","impact":{"breaks_build":false,"breaks_local_verify_strict":false,"breaks_receipt_generation":false},"proposed_fixes":[{"description":"Define and implement dispatcher contract to support a Haskell-native trust anchor: stable command surface, routing precedence (Haskell -> Rust -> Python -> shell), and underscore/kebab mapping.","touched_paths":["scripts/lib/dispatch.sh","scripts/build.sh"]},{"description":"Add explicit configuration points for selecting the canonical backend (e.g., STUNIR_CANONICAL_BACKEND=haskell) and record it in receipts/toolchain lock.","touched_paths":["scripts/lib/dispatch.sh","tools/discover_toolchain.sh"]}],"related":["ISSUE.DISPATCH.0001","ISSUE.DISPATCH.0002","ISSUE.BUILD.0001","ISSUE.BUILD.0002","ISSUE.BUILD.0003","ISSUE.NATIVE.0001","ISSUE.NATIVE.0002","ISSUE.NATIVE.0003"],"reproduction":["./scripts/build.sh"],"root_causes":[{"details":"No repo-level policy/contract encodes 'Haskell-first' routing precedence (Haskell binary as trust anchor; Rust/Python are conformance).","type":"missing_policy"},{"details":"Dispatch library is not implemented; build.sh calls stunir_dispatch but dispatch.sh does not define it.","type":"missing_dispatch_contract"}],"schema":"stunir.issues.issue.v1","severity":"blocking","status":"open","symptoms":["scripts/build.sh stages a Rust native binary (build/stunir_native) when present; no Haskell-native binary is considered.","scripts/lib/dispatch.sh is a stub that forces shell receipt generation and does not define a real stunir_dispatch API.","As a result, there is no way to make a Haskell-compiled tool the canonical reference implementation for bytes/hashes (UN)."],"title":"Haskell-first trust anchor is not encoded: dispatch/build do not route to a Haskell-native binary","workarounds":[{"commands":["./scripts/verify_profile3.sh"],"description":"Use the shell-only Profile 3 verifier scripts for pack integrity until a Haskell verifier binary exists."}]}
