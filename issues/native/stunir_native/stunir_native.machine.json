{
  "category": [
    "native",
    "stunir_native"
  ],
  "evidence": [
    {
      "lines": {
        "end": 138,
        "start": 88
      },
      "note": "GenReceipt path contains receipt IO/hashing; must compile and match verifier core-id rules.",
      "path": "tools/native/rust/stunir-native/src/main.rs",
      "sha256": "33fb0f551aab0fe4a4c3bfe53ee31332f58e74d8bfc8de534ca3d7d06e2d9a31",
      "snippet_sha256": "3dcd05cfc0f84fe79ee30c5acd587576e70b27d9d40859812eec84e6917858ad"
    },
    {
      "lines": {
        "end": 567,
        "start": 517
      },
      "note": "Verifier defines canonical JSON + core-id hashing contract for receipts (no newline in hash input).",
      "path": "tools/verify_build.py",
      "sha256": "7eb1cee982e44b32a3d3e795ec36b287912fba522bcbfb65d0f8a1659b9c4bb8",
      "snippet_sha256": "be08948a8333fcb27afc916ee66027496223fd8300bafb40fe6693e12e308d2c"
    }
  ],
  "expected": [
    "stunir-native must compile cleanly.",
    "receipt_core_id_sha256 must match tools/verify_build.py compute_receipt_core_id() exactly.",
    "Receipt/core objects must serialize via canonical JSON (sorted keys, separators=(',',':'), utf-8, integers only)."
  ],
  "id": "ISSUE.NATIVE.0002",
  "impact": {
    "breaks_build": true,
    "breaks_local_verify_strict": true,
    "breaks_receipt_generation": true
  },
  "proposed_fixes": [
    {
      "description": "Apply PLAN.BUILD.0001 required changes to tools/native/rust/stunir-native/src/main.rs: fix File::open token, hash core object bytes without newline, use canonical ordering (BTreeMap), and ensure ints only.",
      "touched_paths": [
        "tools/native/rust/stunir-native/src/main.rs"
      ]
    }
  ],
  "related": [
    "PLAN.BUILD.0001",
    "ISSUE.RECEIPT.0001",
    "ISSUE.NATIVE.0001"
  ],
  "reproduction": [
    "set -euxo pipefail",
    "./scripts/build.sh",
    "./scripts/verify.sh --local --strict"
  ],
  "root_causes": [
    {
      "details": "Invalid token in File::open(...) call within GenReceipt code path.",
      "type": "syntax_error"
    },
    {
      "details": "core-id hashing must be sha256(canonical_json_bytes(core_object)) with no newline; any deviation breaks strict verification.",
      "type": "hash_contract_mismatch"
    }
  ],
  "schema": "stunir.issues.issue.v1",
  "severity": "blocking",
  "status": "CLOSED",
  "symptoms": [
    "tools/native/rust/stunir-native/src/main.rs contains an invalid token in the GenReceipt path (does not compile).",
    "Even after compilation, receipt_core_id_sha256 logic can mismatch verifier if newline/canonicalization differ."
  ],
  "title": "stunir-native gen-receipt: compile error + receipt_core_id_sha256 mismatch vs tools/verify_build.py",
  "workarounds": [
    {
      "commands": [
        "export STUNIR_USE_SHELL_RECEIPT=1"
      ],
      "description": "Use shell/Python receipt generation until native receipt is fixed."
    }
  ],
  "resolution": "Implemented in Native Core / Shell Integration Pack"
}