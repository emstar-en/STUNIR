{
  "category": [
    "pipeline",
    "dispatch"
  ],
  "evidence": [
    {
      "lines": {
        "end": 49,
        "start": 29
      },
      "note": "build.sh uses underscore-style subcommand names (e.g., spec_to_ir).",
      "path": "scripts/build.sh",
      "sha256": "62e9cfb279b0c0f1519117f570d27e8c40146fb0cef802398765160523f17b58",
      "snippet_sha256": "99708abdc6d4b3c008732b894a50242cf51b5dcfd22189337db2905d486a9c88"
    },
    {
      "lines": {
        "end": 53,
        "start": 13
      },
      "note": "Native tool defines Rust/Clap subcommands; dispatcher must map underscore->kebab or native must add aliases.",
      "path": "tools/native/rust/stunir-native/src/main.rs",
      "sha256": "33fb0f551aab0fe4a4c3bfe53ee31332f58e74d8bfc8de534ca3d7d06e2d9a31",
      "snippet_sha256": "9e2190cd2073467ca4236e1ebfcd1aa5473c709424b280aaef65f4298fd49e5b"
    }
  ],
  "expected": [
    "Dispatcher provides a stable contract: build.sh can call underscore names, while native is invoked with correctly mapped names.",
    "Either dispatch maps underscores->hyphens when calling native, or native defines explicit aliases for underscore forms."
  ],
  "id": "ISSUE.DISPATCH.0002",
  "impact": {
    "breaks_build": true,
    "breaks_local_verify_strict": true,
    "breaks_receipt_generation": false
  },
  "proposed_fixes": [
    {
      "description": "Implement underscore->hyphen mapping in scripts/lib/dispatch.sh when invoking build/stunir_native (preferred). Optionally add Clap aliases in tools/native/rust/stunir-native/src/main.rs.",
      "touched_paths": [
        "scripts/lib/dispatch.sh",
        "tools/native/rust/stunir-native/src/main.rs"
      ]
    }
  ],
  "related": [
    "PLAN.BUILD.0001",
    "ISSUE.NATIVE.0001"
  ],
  "reproduction": [
    "set -euxo pipefail",
    "./scripts/build.sh"
  ],
  "root_causes": [
    {
      "details": "Shell pipeline uses underscore subcommand naming; Clap typically exposes kebab-case for multiword commands unless explicitly configured.",
      "type": "interface_mismatch"
    }
  ],
  "schema": "stunir.issues.issue.v1",
  "severity": "high",
  "status": "CLOSED",
  "symptoms": [
    "scripts/build.sh invokes dispatcher subcommands like spec_to_ir/gen_provenance/compile_provenance.",
    "If dispatch routes to compiled native binary using Clap defaults, commands may be kebab-case (spec-to-ir, gen-provenance, compile-provenance), causing native invocation failures."
  ],
  "title": "Underscore vs kebab-case subcommand mismatch between scripts/build.sh and stunir-native (dispatch must map or native must add aliases)",
  "workarounds": [
    {
      "commands": [
        "export STUNIR_USE_NATIVE=0  # if supported by dispatcher"
      ],
      "description": "Force shell fallbacks for affected subcommands until mapping/aliases are implemented."
    }
  ],
  "resolution": "Implemented in Native Core / Shell Integration Pack"
}