{
  "category": [
    "pipeline",
    "build"
  ],
  "evidence": [
    {
      "lines": {
        "end": 90,
        "start": 1
      },
      "note": "Uses stunir_dispatch and writes build/ir.json + receipts/spec_ir.json, not asm/spec_ir.txt.",
      "path": "scripts/build.sh",
      "sha256": "62e9cfb279b0c0f1519117f570d27e8c40146fb0cef802398765160523f17b58",
      "snippet_sha256": "149c366769508758d9872a45be3c25399cb747ce47b15e97c61957fcc267104b"
    },
    {
      "lines": {
        "end": 80,
        "start": 1
      },
      "note": "Implements the verifier-aligned pipeline using tools/*.py and emits receipts/spec_ir.json + receipts/prov_emit.json.",
      "path": "scripts/build_docker.sh",
      "sha256": "8af694aadf57adb39a0a53e508a107af7da5f4b55dd4a1e381537f9fe76ee3fc",
      "snippet_sha256": "5234b5dda5bb8905ae382da486a76c8e48e81b39d8060855df1a92803f5cc161"
    },
    {
      "lines": {
        "end": 1010,
        "start": 899
      },
      "note": "Defines strict-mode required receipts/manifests and artifact paths.",
      "path": "tools/verify_build.py",
      "sha256": "7eb1cee982e44b32a3d3e795ec36b287912fba522bcbfb65d0f8a1659b9c4bb8",
      "snippet_sha256": "b5b22f084e45aa12b032d19c38c3d2f4adc7cf8cf2bfc17ec7ba8557dcd44bc2"
    }
  ],
  "expected": [
    "One canonical build pipeline that produces artifacts and receipts matching tools/verify_build.py in strict mode.",
    "Target conventions: IR text at asm/spec_ir.txt, provenance at build/provenance.json + build/provenance.h, compiled prov_emit at bin/prov_emit, receipts at receipts/*.json."
  ],
  "id": "ISSUE.BUILD.0001",
  "impact": {
    "breaks_build": true,
    "breaks_local_verify_strict": true,
    "breaks_receipt_generation": true
  },
  "proposed_fixes": [
    {
      "description": "Make scripts/build.sh produce the same artifact set as scripts/build_docker.sh and remove/repair the stunir_dispatch dependency.",
      "touched_paths": [
        "scripts/build.sh",
        "scripts/lib/dispatch.sh",
        "scripts/lib/receipt.sh"
      ]
    }
  ],
  "related": [
    "ISSUE.DISPATCH.0001",
    "ISSUE.RECEIPT.0001",
    "ISSUE.MANIFEST.0001",
    "ISSUE.PROV.0001"
  ],
  "reproduction": [
    "set -euxo pipefail",
    "./scripts/build.sh",
    "./scripts/verify.sh --local --strict"
  ],
  "root_causes": [
    {
      "details": "scripts/build_docker.sh implements the verifier-aligned pipeline using Python tools; scripts/build.sh appears to be an alternate pipeline with different outputs + an incomplete dispatcher.",
      "type": "pipeline_split"
    }
  ],
  "schema": "stunir.issues.issue.v1",
  "severity": "blocking",
  "status": "CLOSED",
  "symptoms": [
    "Strict verifier expects artifacts and receipts aligned with the docker pipeline (spec/, asm/, bin/prov_emit, receipts/*.json).",
    "Current build.sh writes build/spec.json and build/ir.json and attempts to receipt those, which does not match build_docker.sh + verify expectations."
  ],
  "title": "scripts/build.sh pipeline diverges from tools/verify_build.py contract (paths, targets, and receipts)",
  "workarounds": [
    {
      "commands": [
        "./scripts/build_docker.sh",
        "./scripts/verify.sh --local --strict"
      ],
      "description": "Prefer scripts/build_docker.sh as the reference pipeline until scripts/build.sh is brought back in sync."
    }
  ],
  "resolution": "Implemented in Native Core / Shell Integration Pack"
}