{"category":["pipeline","build"],"id":"PLAN.BUILD.0001","payload":{"acceptance":{"must_be_compatible_with":["scripts/verify.sh local mode strict (tools/verify_build.py --local --strict)"],"must_exist_outputs":["build/epoch.json","build/spec.json","build/ir.json","build/provenance.json","build/provenance.h","build/provenance.bin","receipts/spec_ir.json","receipts/prov_emit.json","receipts/ir_manifest.json","receipts/ir_bundle_manifest.json"],"must_hold_invariants":["build/epoch.json is canonical JSON (stunir-json-c14n-v1)","build/provenance.json is canonical JSON and byte-for-byte reproducible by tools/gen_provenance.py","receipts/spec_ir.json and receipts/prov_emit.json are canonical JSON and have receipt_core_id_sha256 matching verifier","receipts/ir_manifest.json and receipts/ir_bundle_manifest.json are canonical JSON","receipts/ir_bundle_manifest.json bundle_sha256 equals sha256(build/ir.json)"]},"breakages_to_fix":[{"files":["scripts/lib/dispatch.sh","scripts/lib/receipt.sh","tools/receipt.py"],"id":"BLOCKER.DISPATCH.RECEIPT","severity":"hard_fail","symptom":"dispatch routes receipt to tools/receipt.py (dummy) and receipt.sh emits wrong shape"},{"files":["scripts/build.sh"],"id":"BLOCKER.BUILD.MANIFEST.C14N","severity":"hard_fail","symptom":"build.sh writes manifests with whitespace and may set bundle_sha256='unknown'"},{"files":["scripts/build.sh"],"id":"BLOCKER.BUILD.EPOCH.PROPAGATION","severity":"hard_fail","symptom":"build.sh calls gen_provenance with --epoch 0; must match build/epoch.json when SOURCE_DATE_EPOCH is set"},{"files":["tools/native/rust/stunir-native/src/main.rs"],"id":"BLOCKER.NATIVE.RECEIPT.CORE_ID","severity":"hard_fail","symptom":"native GenReceipt hashes receipt bytes + newline instead of verifier core object canonical bytes"},{"files":["tools/native/rust/stunir-native/src/main.rs","tools/verify_build.py"],"id":"BLOCKER.NATIVE.PROVENANCE.PARITY","severity":"hard_fail","symptom":"native GenProvenance output does not match tools/gen_provenance.py (verifier rebuilds via tools/gen_provenance.py and byte-compares)"}],"file_update_spec":[{"action":"rewrite_file","path":"scripts/lib/dispatch.sh","precondition_sha256":"ece4e022838fec52a9f6f3efe6d11f0da94d082c684ccd7f0c62ab8aba4ab229","requirements":{"canonicalization_helpers":{"stunir_canon_echo":{"input":"single JSON text argument","must_match":"tools/verify_build.py canonical_json_bytes() rules","output":"canonical json bytes to stdout; may end with a single newline"},"stunir_canonize_file":{"input":"path","output":"rewrite file into canonical JSON bytes + trailing newline"}},"command_name_mapping_for_native":{"rule":"map underscores to hyphens (e.g., spec_to_ir -> spec-to-ir)"},"fallbacks":{"check_toolchain":"shell fallback that validates lockfile exists and is parseable JSON (no need to be canonical here, but ok if canonicalized)","compile_provenance":"if native missing, call tools/compile_provenance.py (or implement minimal deterministic format)","epoch":"if native missing, call tools/epoch.py or inline python to write canonical build/epoch.json","import_code":"if native missing, call tools/import_code.py (must be stable ordering, sha256 file bytes, forward-slash relpaths)","receipt":"always route to scripts/lib/receipt.sh (see receipt.sh rewrite below)","spec_to_ir":"if native missing, call tools/spec_to_ir.py"},"must_export_bash_functions":["log_info","log_warn","log_err","stunir_canon_echo","stunir_dispatch","can_dispatch_native"],"native_bin_resolution":{"behavior":"prefer native for most commands when available, but allow command-level overrides below","candidates_in_order_if_STUNIR_NATIVE_BIN_unset":["build/bin/stunir-native","build/stunir_native","build/bin/stunir_native"],"must_require_executable_bit":true},"provenance_routing":{"default":"do NOT use native gen_provenance (until parity-complete); use tools/gen_provenance.py so verifier byte-rebuild passes","env_overrides":["STUNIR_USE_NATIVE_PROVENANCE=1 (only if native output is updated to be byte-for-byte identical to tools/gen_provenance.py)"]},"receipt_routing":{"default":"do NOT dispatch receipt to native or tools/receipt.py; always use scripts/lib/receipt.sh implementation that matches verifier","env_overrides":["STUNIR_USE_NATIVE_RECEIPT=1 to allow native gen-receipt/receipt only after native is fixed to match verifier","STUNIR_USE_SHELL_RECEIPT=1 to force shell receipt regardless of native availability"]}}},{"action":"rewrite_file","path":"scripts/lib/receipt.sh","precondition_sha256":"a5b8fce9b188334c16354e7ffcb98c567d2c4a425fc672a592d37e7c5d34a081","requirements":{"cli_contract_for_cmd_receipt":{"defaults":{"epoch-json":"build/epoch.json"},"optional_flags":["--epoch-json"],"required_flags":["--toolchain-lock","--in-bin","--out-receipt"]},"core_id_hashing":{"core_fields_exact":["schema","target","status","build_epoch","sha256","epoch","inputs","tool","argv"],"must_match_verifier":true,"no_newline_in_hash_input":true},"implementation_guidance":{"recommended":"implement receipt generation in a small inline python block to avoid shell quoting bugs; ensure json.dumps(sort_keys=True,separators=(',',':'),ensure_ascii=False) and forbid floats"},"inputs_policy":{"include_target_as_input":false,"minimum_inputs":[{"kind":"file","path":"build/epoch.json","sha256":"must be computed and present"},{"kind":"file","path":"build/local_toolchain.lock.json","sha256":"must be computed and present"}]},"must_export_bash_functions":["stunir_write_build_receipt","cmd_receipt"],"receipt_shape":{"field_semantics":{"argv":"deterministic argv list reflecting the receipt command (no absolute paths)","build_epoch":"int epoch.selected_epoch","epoch":"object loaded from --epoch-json (must match build/epoch.json for local strict)","inputs":"deterministic list of {path,kind,sha256}; sorted by path","sha256":"sha256(file bytes at --in-bin)","status":"success","target":"exact string path passed via --in-bin","tool":null},"optional_fields":["toolchain_sha256"],"required_fields":["schema","target","status","build_epoch","sha256","epoch","inputs","tool","argv","receipt_core_id_sha256"],"schema":"stunir.receipt.build.v1"},"serialization":{"must_be_canonical_json":true,"optional_trailing_newline":true}}},{"action":"edit_file","path":"scripts/build.sh","precondition_sha256":"30a3326dd0af00c92d8cb8abc9469edfdbb6d2f26cf7d4d012ad1260664ef14a","requirements":{"epoch_propagation":{"behavior":"read build/epoch.json selected_epoch and source and pass both to gen_provenance (epoch + epoch-source)","must_pass_epoch_to_gen_provenance":true},"manifest_generation":{"bundle_sha256":{"fallback_if_no_sha256sum":"use python hashlib to compute sha256(build/ir.json)","must_never_be_unknown":true},"files":["receipts/ir_manifest.json","receipts/ir_bundle_manifest.json"],"must_write_canonical_json":true},"native_staging":{"also_accept_existing_stage_path":"build/stunir_native","notes":["dispatch default currently points at build/bin/stunir-native; staging must match so native route is actually used"],"stage_to":"build/bin/stunir-native"}}},{"action":"edit_file","path":"tools/native/rust/stunir-native/src/main.rs","precondition_sha256":"33fb0f551aab0fe4a4c3bfe53ee31332f58e74d8bfc8de534ca3d7d06e2d9a31","requirements":{"dispatch_compatibility":{"underscore_to_kebab":"either keep relying on dispatch mapping (preferred) or add clap aliases; do not break existing kebab-case behavior"},"gen_receipt_fix":{"core_id_must_match_verifier":true,"must_hash_core_object_only":true,"must_not_include_newline_in_hash":true,"must_not_include_toolchain_sha256_in_core_object":true,"receipt_json_must_be_canonical":true},"provenance_warning":{"do_not_claim_native_gen_provenance_parity":"until native matches tools/gen_provenance.py byte-for-byte, dispatch must keep routing provenance generation to python"},"receipt_field_values":{"argv":"must be deterministic","epoch.source":"must be derived from input (not hard-coded 'default') when possible"}}}],"ground_truth_contract":{"canonical_json_bytes":{"evidence_lines_in_verify_build_py":{"canonical_json_bytes_def":{"end":112,"start":108},"file_is_canonical_json_accepts_trailing_newline":{"end":123,"start":114}},"rules":["utf-8","no floats anywhere","sort_keys=true (lexicographic by unicode codepoint)","separators=(',',':')","optional single trailing newline accepted by verifier for files"]},"receipt_core_id":{"core_fields_exact":["schema","target","status","build_epoch","sha256","epoch","inputs","tool","argv"],"evidence_lines_in_verify_build_py":{"compute_receipt_core_id_def":{"end":555,"start":542}},"hash":"sha256(canonical_json_bytes(core_object))","no_newline_in_hash_input":true},"verifier_file":{"path":"tools/verify_build.py","sha256":"7eb1cee982e44b32a3d3e795ec36b287912fba522bcbfb65d0f8a1659b9c4bb8"}},"ground_truth_urls":{"build_sh":"https://raw.githubusercontent.com/emstar-en/STUNIR/devsite/scripts/build.sh","discover_toolchain_sh":"https://raw.githubusercontent.com/emstar-en/STUNIR/devsite/tools/discover_toolchain.sh","dispatch_sh":"https://raw.githubusercontent.com/emstar-en/STUNIR/devsite/scripts/lib/dispatch.sh","gen_provenance_py":"https://raw.githubusercontent.com/emstar-en/STUNIR/devsite/tools/gen_provenance.py","native_main_rs":"https://raw.githubusercontent.com/emstar-en/STUNIR/devsite/tools/native/rust/stunir-native/src/main.rs","receipt_sh":"https://raw.githubusercontent.com/emstar-en/STUNIR/devsite/scripts/lib/receipt.sh","verify_build_py":"https://raw.githubusercontent.com/emstar-en/STUNIR/devsite/tools/verify_build.py","verify_sh":"https://raw.githubusercontent.com/emstar-en/STUNIR/devsite/scripts/verify.sh"},"non_goals":["Make python route the reference implementation","Implement full native provenance parity in this patch (requires matching tools/gen_provenance.py exactly)"],"notes_for_codegen_model":["Do not introduce new build artifacts or new files unless required by the update spec.","Do not change output paths; verifier assumes these relative paths.","When writing JSON files verified by tools/verify_build.py, emit canonical bytes (no spaces) and optionally a single trailing newline.","Do not rely on tools/receipt.py; it is currently a stub and must not be used by dispatch for build receipts."],"observed_blockers":[{"evidence":[{"lines":{"end":50,"start":1},"observed_sha256":"ece4e022838fec52a9f6f3efe6d11f0da94d082c684ccd7f0c62ab8aba4ab229","path":"scripts/lib/dispatch.sh","sha256":"ece4e022838fec52a9f6f3efe6d11f0da94d082c684ccd7f0c62ab8aba4ab229","snippet_sha256":"ece4e022838fec52a9f6f3efe6d11f0da94d082c684ccd7f0c62ab8aba4ab229"},{"lines":{"end":16,"start":1},"observed_sha256":"b94bd218ef5d6586e3f88a229f61d836dd130eaf90e19c5f724eafdd9339713d","path":"tools/receipt.py","sha256":"b94bd218ef5d6586e3f88a229f61d836dd130eaf90e19c5f724eafdd9339713d","snippet_sha256":"b94bd218ef5d6586e3f88a229f61d836dd130eaf90e19c5f724eafdd9339713d"},{"lines":{"end":62,"start":1},"observed_sha256":"a5b8fce9b188334c16354e7ffcb98c567d2c4a425fc672a592d37e7c5d34a081","path":"scripts/lib/receipt.sh","sha256":"a5b8fce9b188334c16354e7ffcb98c567d2c4a425fc672a592d37e7c5d34a081","snippet_sha256":"a5b8fce9b188334c16354e7ffcb98c567d2c4a425fc672a592d37e7c5d34a081"}],"id":"BLOCKER.DISPATCH.RECEIPT","summary":"dispatch routes receipt to tools/receipt.py (dummy) and receipt.sh emits wrong shape"},{"evidence":[{"lines":{"end":86,"start":1},"observed_sha256":"30a3326dd0af00c92d8cb8abc9469edfdbb6d2f26cf7d4d012ad1260664ef14a","path":"scripts/build.sh","sha256":"30a3326dd0af00c92d8cb8abc9469edfdbb6d2f26cf7d4d012ad1260664ef14a","snippet_sha256":"30a3326dd0af00c92d8cb8abc9469edfdbb6d2f26cf7d4d012ad1260664ef14a"}],"id":"BLOCKER.BUILD.MANIFEST.C14N","summary":"build.sh writes manifests with whitespace and may set bundle_sha256='unknown'"},{"evidence":[{"lines":{"end":75,"start":45},"observed_sha256":"30a3326dd0af00c92d8cb8abc9469edfdbb6d2f26cf7d4d012ad1260664ef14a","path":"scripts/build.sh","sha256":"30a3326dd0af00c92d8cb8abc9469edfdbb6d2f26cf7d4d012ad1260664ef14a","snippet_sha256":"ca3e43851951e7bbf6f40e2ff8a6f258eece5455c738cf80a5ac6907c3807ba1"}],"id":"BLOCKER.BUILD.EPOCH.PROPAGATION","summary":"build.sh calls gen_provenance with --epoch 0; must match build/epoch.json when SOURCE_DATE_EPOCH is set"},{"evidence":[{"lines":{"end":216,"start":172},"observed_sha256":"33fb0f551aab0fe4a4c3bfe53ee31332f58e74d8bfc8de534ca3d7d06e2d9a31","path":"tools/native/rust/stunir-native/src/main.rs","sha256":"33fb0f551aab0fe4a4c3bfe53ee31332f58e74d8bfc8de534ca3d7d06e2d9a31","snippet_sha256":"46fd37cc455445389006cd346e1f44bf964204b881f4b6aa4e46566f451014c8"}],"id":"BLOCKER.NATIVE.RECEIPT.CORE_ID","summary":"native GenReceipt hashes receipt bytes + newline instead of verifier core object canonical bytes"},{"evidence":[{"lines":{"end":896,"start":834},"observed_sha256":"7eb1cee982e44b32a3d3e795ec36b287912fba522bcbfb65d0f8a1659b9c4bb8","path":"tools/verify_build.py","sha256":"7eb1cee982e44b32a3d3e795ec36b287912fba522bcbfb65d0f8a1659b9c4bb8","snippet_sha256":"57fa28ab9bb7896985de76a2e4e5b50787ea00fb16065299e68057739e0f4e60"},{"lines":{"end":171,"start":152},"observed_sha256":"33fb0f551aab0fe4a4c3bfe53ee31332f58e74d8bfc8de534ca3d7d06e2d9a31","path":"tools/native/rust/stunir-native/src/main.rs","sha256":"33fb0f551aab0fe4a4c3bfe53ee31332f58e74d8bfc8de534ca3d7d06e2d9a31","snippet_sha256":"39e1f36a31f1c86f471398c82716544f6341db11b672287d5333523b7e777a32"}],"id":"BLOCKER.NATIVE.PROVENANCE.PARITY","summary":"native GenProvenance output does not match tools/gen_provenance.py (verifier rebuilds via tools/gen_provenance.py and byte-compares)"}],"patch_bundle":{"acceptance":{"local_strict_profile":{"must_be_compatible_with":["scripts/verify.sh local mode strict (tools/verify_build.py --local --strict)"],"must_exist_outputs":["build/epoch.json","build/spec.json","build/ir.json","build/provenance.json","build/provenance.h","build/provenance.bin","receipts/spec_ir.json","receipts/prov_emit.json","receipts/ir_manifest.json","receipts/ir_bundle_manifest.json"],"must_hold_invariants":["build/epoch.json is canonical JSON (stunir-json-c14n-v1)","build/provenance.json is canonical JSON and byte-for-byte reproducible by tools/gen_provenance.py","receipts/spec_ir.json and receipts/prov_emit.json are canonical JSON and have receipt_core_id_sha256 matching verifier","receipts/ir_manifest.json and receipts/ir_bundle_manifest.json are canonical JSON","receipts/ir_bundle_manifest.json bundle_sha256 equals sha256(build/ir.json)"]}},"canonicalization":"stunir-json-c14n-v1","file_update_spec":[{"action":"rewrite_file","path":"scripts/lib/dispatch.sh","precondition_sha256":"ece4e022838fec52a9f6f3efe6d11f0da94d082c684ccd7f0c62ab8aba4ab229","requirements":{"canonicalization_helpers":{"stunir_canon_echo":{"input":"single JSON text argument","must_match":"tools/verify_build.py canonical_json_bytes() rules","output":"canonical json bytes to stdout; may end with a single newline"},"stunir_canonize_file":{"input":"path","output":"rewrite file into canonical JSON bytes + trailing newline"}},"command_name_mapping_for_native":{"rule":"map underscores to hyphens (e.g., spec_to_ir -> spec-to-ir)"},"fallbacks":{"check_toolchain":"shell fallback that validates lockfile exists and is parseable JSON (no need to be canonical here, but ok if canonicalized)","compile_provenance":"if native missing, call tools/compile_provenance.py (or implement minimal deterministic format)","epoch":"if native missing, call tools/epoch.py or inline python to write canonical build/epoch.json","import_code":"if native missing, call tools/import_code.py (must be stable ordering, sha256 file bytes, forward-slash relpaths)","receipt":"always route to scripts/lib/receipt.sh (see receipt.sh rewrite below)","spec_to_ir":"if native missing, call tools/spec_to_ir.py"},"must_export_bash_functions":["log_info","log_warn","log_err","stunir_canon_echo","stunir_dispatch","can_dispatch_native"],"native_bin_resolution":{"behavior":"prefer native for most commands when available, but allow command-level overrides below","candidates_in_order_if_STUNIR_NATIVE_BIN_unset":["build/bin/stunir-native","build/stunir_native","build/bin/stunir_native"],"must_require_executable_bit":true},"provenance_routing":{"default":"do NOT use native gen_provenance (until parity-complete); use tools/gen_provenance.py so verifier byte-rebuild passes","env_overrides":["STUNIR_USE_NATIVE_PROVENANCE=1 (only if native output is updated to be byte-for-byte identical to tools/gen_provenance.py)"]},"receipt_routing":{"default":"do NOT dispatch receipt to native or tools/receipt.py; always use scripts/lib/receipt.sh implementation that matches verifier","env_overrides":["STUNIR_USE_NATIVE_RECEIPT=1 to allow native gen-receipt/receipt only after native is fixed to match verifier","STUNIR_USE_SHELL_RECEIPT=1 to force shell receipt regardless of native availability"]}}},{"action":"rewrite_file","path":"scripts/lib/receipt.sh","precondition_sha256":"a5b8fce9b188334c16354e7ffcb98c567d2c4a425fc672a592d37e7c5d34a081","requirements":{"cli_contract_for_cmd_receipt":{"defaults":{"epoch-json":"build/epoch.json"},"optional_flags":["--epoch-json"],"required_flags":["--toolchain-lock","--in-bin","--out-receipt"]},"core_id_hashing":{"core_fields_exact":["schema","target","status","build_epoch","sha256","epoch","inputs","tool","argv"],"must_match_verifier":true,"no_newline_in_hash_input":true},"implementation_guidance":{"recommended":"implement receipt generation in a small inline python block to avoid shell quoting bugs; ensure json.dumps(sort_keys=True,separators=(',',':'),ensure_ascii=False) and forbid floats"},"inputs_policy":{"include_target_as_input":false,"minimum_inputs":[{"kind":"file","path":"build/epoch.json","sha256":"must be computed and present"},{"kind":"file","path":"build/local_toolchain.lock.json","sha256":"must be computed and present"}]},"must_export_bash_functions":["stunir_write_build_receipt","cmd_receipt"],"receipt_shape":{"field_semantics":{"argv":"deterministic argv list reflecting the receipt command (no absolute paths)","build_epoch":"int epoch.selected_epoch","epoch":"object loaded from --epoch-json (must match build/epoch.json for local strict)","inputs":"deterministic list of {path,kind,sha256}; sorted by path","sha256":"sha256(file bytes at --in-bin)","status":"success","target":"exact string path passed via --in-bin","tool":null},"optional_fields":["toolchain_sha256"],"required_fields":["schema","target","status","build_epoch","sha256","epoch","inputs","tool","argv","receipt_core_id_sha256"],"schema":"stunir.receipt.build.v1"},"serialization":{"must_be_canonical_json":true,"optional_trailing_newline":true}}},{"action":"edit_file","path":"scripts/build.sh","precondition_sha256":"30a3326dd0af00c92d8cb8abc9469edfdbb6d2f26cf7d4d012ad1260664ef14a","requirements":{"epoch_propagation":{"behavior":"read build/epoch.json selected_epoch and source and pass both to gen_provenance (epoch + epoch-source)","must_pass_epoch_to_gen_provenance":true},"manifest_generation":{"bundle_sha256":{"fallback_if_no_sha256sum":"use python hashlib to compute sha256(build/ir.json)","must_never_be_unknown":true},"files":["receipts/ir_manifest.json","receipts/ir_bundle_manifest.json"],"must_write_canonical_json":true},"native_staging":{"also_accept_existing_stage_path":"build/stunir_native","notes":["dispatch default currently points at build/bin/stunir-native; staging must match so native route is actually used"],"stage_to":"build/bin/stunir-native"}}},{"action":"edit_file","path":"tools/native/rust/stunir-native/src/main.rs","precondition_sha256":"33fb0f551aab0fe4a4c3bfe53ee31332f58e74d8bfc8de534ca3d7d06e2d9a31","requirements":{"dispatch_compatibility":{"underscore_to_kebab":"either keep relying on dispatch mapping (preferred) or add clap aliases; do not break existing kebab-case behavior"},"gen_receipt_fix":{"core_id_must_match_verifier":true,"must_hash_core_object_only":true,"must_not_include_newline_in_hash":true,"must_not_include_toolchain_sha256_in_core_object":true,"receipt_json_must_be_canonical":true},"provenance_warning":{"do_not_claim_native_gen_provenance_parity":"until native matches tools/gen_provenance.py byte-for-byte, dispatch must keep routing provenance generation to python"},"receipt_field_values":{"argv":"must be deterministic","epoch.source":"must be derived from input (not hard-coded 'default') when possible"}}}],"ground_truth_contract":{"canonical_json_bytes":{"evidence_lines_in_verify_build_py":{"canonical_json_bytes_def":{"end":112,"start":108},"file_is_canonical_json_accepts_trailing_newline":{"end":123,"start":114}},"rules":["utf-8","no floats anywhere","sort_keys=true (lexicographic by unicode codepoint)","separators=(',',':')","optional single trailing newline accepted by verifier for files"]},"receipt_core_id":{"core_fields_exact":["schema","target","status","build_epoch","sha256","epoch","inputs","tool","argv"],"evidence_lines_in_verify_build_py":{"compute_receipt_core_id_def":{"end":555,"start":542}},"hash":"sha256(canonical_json_bytes(core_object))","no_newline_in_hash_input":true},"verifier_file":{"path":"tools/verify_build.py","sha256":"7eb1cee982e44b32a3d3e795ec36b287912fba522bcbfb65d0f8a1659b9c4bb8"}},"non_goals":["Make python route the reference implementation","Implement full native provenance parity in this patch (requires matching tools/gen_provenance.py exactly)"],"notes_for_codegen_model":["Do not introduce new build artifacts or new files unless required by the update spec.","Do not change output paths; verifier assumes these relative paths.","When writing JSON files verified by tools/verify_build.py, emit canonical bytes (no spaces) and optionally a single trailing newline.","Do not rely on tools/receipt.py; it is currently a stub and must not be used by dispatch for build receipts."],"observed_blockers":[{"evidence":[{"lines":{"end":50,"start":1},"observed_sha256":"ece4e022838fec52a9f6f3efe6d11f0da94d082c684ccd7f0c62ab8aba4ab229","path":"scripts/lib/dispatch.sh","sha256":"ece4e022838fec52a9f6f3efe6d11f0da94d082c684ccd7f0c62ab8aba4ab229","snippet_sha256":"ece4e022838fec52a9f6f3efe6d11f0da94d082c684ccd7f0c62ab8aba4ab229"},{"lines":{"end":16,"start":1},"observed_sha256":"b94bd218ef5d6586e3f88a229f61d836dd130eaf90e19c5f724eafdd9339713d","path":"tools/receipt.py","sha256":"b94bd218ef5d6586e3f88a229f61d836dd130eaf90e19c5f724eafdd9339713d","snippet_sha256":"b94bd218ef5d6586e3f88a229f61d836dd130eaf90e19c5f724eafdd9339713d"},{"lines":{"end":62,"start":1},"observed_sha256":"a5b8fce9b188334c16354e7ffcb98c567d2c4a425fc672a592d37e7c5d34a081","path":"scripts/lib/receipt.sh","sha256":"a5b8fce9b188334c16354e7ffcb98c567d2c4a425fc672a592d37e7c5d34a081","snippet_sha256":"a5b8fce9b188334c16354e7ffcb98c567d2c4a425fc672a592d37e7c5d34a081"}],"id":"BLOCKER.DISPATCH.RECEIPT","summary":"dispatch routes receipt to tools/receipt.py (dummy) and receipt.sh emits wrong shape"},{"evidence":[{"lines":{"end":86,"start":1},"observed_sha256":"30a3326dd0af00c92d8cb8abc9469edfdbb6d2f26cf7d4d012ad1260664ef14a","path":"scripts/build.sh","sha256":"30a3326dd0af00c92d8cb8abc9469edfdbb6d2f26cf7d4d012ad1260664ef14a","snippet_sha256":"30a3326dd0af00c92d8cb8abc9469edfdbb6d2f26cf7d4d012ad1260664ef14a"}],"id":"BLOCKER.BUILD.MANIFEST.C14N","summary":"build.sh writes manifests with whitespace and may set bundle_sha256='unknown'"},{"evidence":[{"lines":{"end":75,"start":45},"observed_sha256":"30a3326dd0af00c92d8cb8abc9469edfdbb6d2f26cf7d4d012ad1260664ef14a","path":"scripts/build.sh","sha256":"30a3326dd0af00c92d8cb8abc9469edfdbb6d2f26cf7d4d012ad1260664ef14a","snippet_sha256":"ca3e43851951e7bbf6f40e2ff8a6f258eece5455c738cf80a5ac6907c3807ba1"}],"id":"BLOCKER.BUILD.EPOCH.PROPAGATION","summary":"build.sh calls gen_provenance with --epoch 0; must match build/epoch.json when SOURCE_DATE_EPOCH is set"},{"evidence":[{"lines":{"end":216,"start":172},"observed_sha256":"33fb0f551aab0fe4a4c3bfe53ee31332f58e74d8bfc8de534ca3d7d06e2d9a31","path":"tools/native/rust/stunir-native/src/main.rs","sha256":"33fb0f551aab0fe4a4c3bfe53ee31332f58e74d8bfc8de534ca3d7d06e2d9a31","snippet_sha256":"46fd37cc455445389006cd346e1f44bf964204b881f4b6aa4e46566f451014c8"}],"id":"BLOCKER.NATIVE.RECEIPT.CORE_ID","summary":"native GenReceipt hashes receipt bytes + newline instead of verifier core object canonical bytes"},{"evidence":[{"lines":{"end":896,"start":834},"observed_sha256":"7eb1cee982e44b32a3d3e795ec36b287912fba522bcbfb65d0f8a1659b9c4bb8","path":"tools/verify_build.py","sha256":"7eb1cee982e44b32a3d3e795ec36b287912fba522bcbfb65d0f8a1659b9c4bb8","snippet_sha256":"57fa28ab9bb7896985de76a2e4e5b50787ea00fb16065299e68057739e0f4e60"},{"lines":{"end":171,"start":152},"observed_sha256":"33fb0f551aab0fe4a4c3bfe53ee31332f58e74d8bfc8de534ca3d7d06e2d9a31","path":"tools/native/rust/stunir-native/src/main.rs","sha256":"33fb0f551aab0fe4a4c3bfe53ee31332f58e74d8bfc8de534ca3d7d06e2d9a31","snippet_sha256":"39e1f36a31f1c86f471398c82716544f6341db11b672287d5333523b7e777a32"}],"id":"BLOCKER.NATIVE.PROVENANCE.PARITY","summary":"native GenProvenance output does not match tools/gen_provenance.py (verifier rebuilds via tools/gen_provenance.py and byte-compares)"}],"repo":{"branch":"devsite","name":"emstar-en/STUNIR"},"schema":"stunir.codegen.patch_bundle.v1","scope":{"explicitly_ignore":["python route as gold standard","lisp routes/targets unless explicitly requested"],"focus":"compiled-binaries route (native-first dispatch) for local strict verification"}},"pipeline_simulation_local_strict":{"entrypoint":"scripts/build.sh","steps":[{"inputs":["repo tools/discover_toolchain.sh","host tools: python3, bash, git, etc."],"n":0,"name":"toolchain lock","notes":["build.sh runs stunir_dispatch check_toolchain if lock exists, else runs tools/discover_toolchain.sh"],"outputs":["build/local_toolchain.lock.json"]},{"inputs":["env SOURCE_DATE_EPOCH (optional)"],"n":1,"name":"epoch","outputs":["build/epoch.json"],"verifier_requires":["build/epoch.json must be canonical JSON (stunir-json-c14n-v1)"]},{"inputs":["src/ directory (optional)"],"n":2,"name":"import_code","notes":["If src/ missing, build.sh writes a canonical minimal spec object with kind=spec, modules=[]"],"outputs":["build/spec.json"]},{"inputs":["build/spec.json"],"n":3,"name":"spec_to_ir","outputs":["build/ir.json"]},{"inputs":["build/local_toolchain.lock.json","build/epoch.json","build/ir.json"],"n":"3.1","name":"receipt for build/ir.json","outputs":["receipts/spec_ir.json"],"verifier_requires":["receipts/spec_ir.json canonical JSON","schema == stunir.receipt.build.v1","receipt_core_id_sha256 equals verifier compute_receipt_core_id()","build_epoch + epoch.* match build/epoch.json","sha256 binds to build/ir.json"]},{"inputs":["epoch (int)","epoch_source (string)"],"n":4,"name":"gen_provenance","outputs":["build/provenance.json","build/provenance.h"],"verifier_requires":["build/provenance.json reproducible by tools/gen_provenance.py (byte-for-byte)","build/provenance.json canonical JSON"]},{"inputs":["build/provenance.json"],"n":5,"name":"compile_provenance","outputs":["build/provenance.bin"]},{"inputs":["build/local_toolchain.lock.json","build/epoch.json","build/provenance.bin"],"n":6,"name":"receipt for build/provenance.bin","outputs":["receipts/prov_emit.json"]},{"n":7,"name":"manifests","notes":["Empty ir_manifest files[] and empty ir_bundle_manifest entries[] are acceptable if asm/ir/*.dcbor does not exist"],"outputs":["receipts/ir_manifest.json","receipts/ir_bundle_manifest.json"],"verifier_requires":["both manifests must be canonical JSON","ir_bundle_manifest.bundle_sha256 must match sha256(build/ir.json)"]}]},"repo":{"branch":"devsite","name":"emstar-en/STUNIR"},"scope":{"explicitly_ignore":["python route as gold standard","lisp routes/targets unless explicitly requested"],"focus":"compiled-binaries route (native-first dispatch) for local strict verification"},"sha256_mismatches":[],"task_id":"stunir_complete_compiled_binaries_route_local_strict"},"schema":"stunir.issues.plan.v1","severity":"blocking","status":"open","title":"Complete compiled-binaries route (native-first) + local strict verifier compatibility"}