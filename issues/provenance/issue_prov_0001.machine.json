{"category":["provenance"],"evidence":[{"lines":{"end":897,"start":834},"note":"Verifier rebuilds provenance using the build_epoch + epoch_source embedded in provenance.json and roots spec/asm.","path":"tools/verify_build.py","sha256":"7eb1cee982e44b32a3d3e795ec36b287912fba522bcbfb65d0f8a1659b9c4bb8","snippet_sha256":"57fa28ab9bb7896985de76a2e4e5b50787ea00fb16065299e68057739e0f4e60"},{"lines":{"end":70,"start":38},"note":"Calls gen_provenance via dispatcher with different roots/epoch.","path":"scripts/build.sh","sha256":"62e9cfb279b0c0f1519117f570d27e8c40146fb0cef802398765160523f17b58","snippet_sha256":"e560b0e0ab2e428d3ec46571e252087d3c2fec39986b7aa4c756a19f5d842b0e"},{"lines":{"end":260,"start":1},"note":"Defines provenance format and canonicalization requirements.","path":"tools/gen_provenance.py","sha256":"5bd6c4d8e7922bc2f60fd13d56450610ae218037209219b0d5aa57a19f44cbb7","snippet_sha256":"79aad9447fe77d08088fed128e2b2f5c2e430e6a7f0c08bf3259ca2b3a10b375"}],"expected":["build/provenance.json must be canonical JSON and exactly reproducible by rerunning tools/gen_provenance.py using the epoch + epoch_source embedded in provenance.json, with spec-root=spec and asm-root=asm."],"id":"ISSUE.PROV.0001","impact":{"breaks_build":false,"breaks_local_verify_strict":true,"breaks_receipt_generation":false},"proposed_fixes":[{"description":"Align scripts/build.sh provenance generation flags with verify_build.py: roots spec/ + asm/, epoch from build/epoch.json.","touched_paths":["scripts/build.sh"]}],"related":["ISSUE.BUILD.0001"],"reproduction":["./scripts/verify.sh --local --strict"],"root_causes":[{"details":"scripts/build.sh calls gen_provenance via dispatcher with --spec-root build and --asm-root src and hard-codes --epoch 0, which cannot match the verifier rebuild contract.","type":"root_mismatch"}],"schema":"stunir.issues.issue.v1","severity":"blocking","status":"open","symptoms":["Verifier fails with 'build/provenance.json is not reproducible' or missing provenance.h in strict mode.","Rebuild command in verifier uses spec-root spec and asm-root asm; any other roots will not reproduce."],"title":"Provenance reproducibility contract: verify_build.py rebuilds provenance from spec/ + asm/, but build.sh uses different roots/epoch","workarounds":[{"commands":["mkdir -p build asm","python3 -B tools/epoch.py --out-json build/epoch.json --print-epoch","E=$(python3 - <<'PY'\nimport json; print(json.load(open('build/epoch.json'))['selected_epoch'])\nPY)","S=$(python3 - <<'PY'\nimport json; print(json.load(open('build/epoch.json'))['source'])\nPY)","python3 -B tools/gen_provenance.py --epoch \"$E\" --epoch-source \"$S\" --spec-root spec --asm-root asm --out-header build/provenance.h --out-json build/provenance.json"],"description":"Generate provenance exactly the way the verifier rebuilds it."}]}